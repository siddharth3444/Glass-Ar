(this["webpackJsonpbasic-virtual-tryon-glasses"]=this["webpackJsonpbasic-virtual-tryon-glasses"]||[]).push([[0],{12:function(e,t,o){e.exports=o(28)},17:function(e,t,o){},18:function(e,t,o){},25:function(e,t){},26:function(e,t){},27:function(e,t){},28:function(e,t,o){"use strict";o.r(t);var i,n,a,s,r,c,d=o(2),l=o.n(d),m=o(8),v=o.n(m),p=(o(17),o(18),o(1)),u=(o(19),o(9)),w=o(11),y=o(10),h=o(0);let g,b;var f;let x,E;function W(e){c=document.getElementById("tryon-video"),f=document.getElementById("threejsContainer"),b=new p.L(50,c.videoWidth/c.videoHeight,1,5e3),b.position.z=c.videoHeight,b.position.x=-c.videoWidth/2,b.position.y=-c.videoHeight/2,(r=new p.Y(c)).minFilter=p.w,E=new p.X(new p.E({map:r,depthWrite:!1,side:p.k})),x=new p.T,x.add(E),E.center.set(.5,.5),E.scale.set(-c.videoWidth,c.videoHeight,1),E.position.copy(b.position),E.position.z=0,function(){var e=new p.M(15658734);e.position.set(10,50,20),x.add(e);var t=new p.a(16742399);x.add(t)}(),function(){const e=new p.r;e.vertices.push(new p.cb(1,0,0)),e.vertices.push(new p.cb(-1,0,0)),e.vertices.push(new p.cb(0,0,1)),e.faces.push(new p.n(0,1,2)),(s=new p.D(e,new p.E({side:p.k}))).visible=!1,x.add(s)}(),(new u.a).load("/basic-virtual-tryon-glasses/obj/facemesh.obj",e=>{e.traverse(e=>{e instanceof p.D&&((a=new p.D(e.geometry,new p.F({side:p.q,color:"blue"}))).material.colorWrite=!1,a.renderOrder=5,x.add(a))})}),function(e){(new w.a).load("/basic-virtual-tryon-glasses/obj/Aviaattorit.fbx",(function(t){(n=t).name=e,n.renderOrder=3,x.add(n)}))}(e),g=new p.gb({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),g.setPixelRatio(window.devicePixelRatio),g.setSize(640,640*c.videoHeight/c.videoWidth),f.appendChild(g.domElement),window.addEventListener("resize",z,!1),j()}function z(){b.aspect=c.videoWidth/c.videoHeight,b.updateProjectionMatrix(),g.setSize(640,640*c.videoHeight/c.videoWidth),g.setClearColor(15658734,1)}function j(){r.needsUpdate=!0,requestAnimationFrame(j),g.render(x,b)}async function k(){const e=await i.estimateFaces(c);if(e.length>0){a.visible=!0,n.visible=!0;for(let t=0;t<e.length;t++){const o=e[t].scaledMesh,i=new p.cb(-o[7][0],-o[7][1],-o[7][2]),r=new p.cb(-o[175][0],-o[175][1],-o[175][2]),c=new p.cb(-o[263][0],-o[263][1],-o[263][2]);s.geometry.vertices[0].copy(r),s.geometry.vertices[1].copy(i),s.geometry.vertices[2].copy(c),s.geometry.verticesNeedUpdate=!0,s.geometry.computeFaceNormals();const d=new p.cb(-o[10][0],-o[10][1],-o[10][2]),l=new p.cb(-o[175][0],-o[175][1],-o[175][2]),m=d.distanceTo(l)/110.5,v=new p.cb(-o[168][0],-o[5][1],-o[10][2]-190),u=new p.cb(-o[168][0],-o[1][1],-o[10][2]-160),w=s.geometry.faces[0].normal.clone();w.transformDirection(s.matrixWorld),w.add(u);const y=s.geometry.faces[0].normal.clone();y.transformDirection(s.matrixWorld),y.add(v),a.position.set(v.x,v.y,v.z),n.position.set(u.x,u.y,u.z),a.lookAt(y),n.lookAt(w);const h=u.x-b.position.x,g=u.y-b.position.y,f=2.8,x=960,E=3.6,W=960;a.position.x+=h/f,n.position.x+=h/f,a.rotation.y+=-h/x,n.rotation.y+=-h/x,a.position.y+=g/E,n.position.y+=g/E,a.rotation.x+=g/W,n.rotation.x+=g/W,n.rotation.x+=.1,Math.abs(n.rotation.y)>.15&&(a.position.z-=40,n.position.z-=40),n.scale.set(8*m,8*m,1.35*m*8);const z=1.1*m;a.scale.set(z,z,z),a.updateWorldMatrix(),n.updateWorldMatrix()}}else n.visible=!1,a.visible=!1;requestAnimationFrame(k)}const M=()=>(Object(d.useEffect)(()=>(async function(){var e=document.getElementById("tryon-video");await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}}).then(t=>{e.srcObject=t}),e.oncanplay=t=>{e.play(),W("purple1"),async function(){await h.Yb("webgl"),i=await y.a({maxFaces:1}),k()}()}}(),()=>{}),[]),l.a.createElement("div",{className:"row arcomp"},l.a.createElement("div",{id:"threejsContainer"},l.a.createElement("video",{id:"tryon-video"}))));class D extends d.Component{render(){return l.a.createElement("div",{className:"App"},l.a.createElement(M,{onReady:this.ready}))}}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));v.a.render(l.a.createElement(D,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()}).catch(e=>{console.error(e.message)})}},[[12,1,2]]]);
//# sourceMappingURL=main.54d93961.chunk.js.map